{% extends "base.html" %}
{% block cart_block %}
<div class='text-slate-200 p-4 font-mono'>
    {% if user.is_authenticated %}
    <p class=' p-2 text-left font-semibold'>{{user}} you have {{total_cart}} item in your cart.</p>
    <p class=' p-2 text-left font-semibold underline'>Items Carted by You</p>
        {% for item in form %}
            {% if user.id in item.cart_users %}
                <ul class='my-2   flex flex-row'>
                <li class='border-b border-blue-500'>
                    <div class='text-justify '>
                        <form action="{% url 'item-purchase' %}" method="post"> 
                            {% csrf_token %}
                            <input type="hidden" name="course" value="{{ item.id }}">
                            <input type="hidden" name="user" value="{{ user.id }}">
                            <input type="hidden" name="price" value="{{ item.price }}">
                            <img src="/media/{{ item.thumbnail }}" alt="name" class="w-full h-[200px] py-2 my-1"/>
                            <h3>Title: {{ item.title }}</h3>
                            <h3>Posted By : {{ item.instructor.username }}</h3>
                            <p>Published On : {{ item.created_at }}</p>
                            <p>Price: {{ item.price }}</p>
                            <button type="submit" class="py-1">
                                <span class="items-center justify-center">Buy Now<i class="fa-solid fa-bag-shopping w-6 h-6 font-serif items-baseline text-blue-200 hover:text-blue-700"></i></span>
                            </button>
                            <br>    
                        </form>  
                    {% comment %} <form>
                        {% csrf_token %}
                        <button id="rzp-button1">Pay</button>
                        <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
                        <script>
                        var options = {
                        "key": "rzp_test_kaz60tEn560E6V", // Enter the Key ID generated from the Dashboard
                        "amount": {{item.price}}, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
                        "currency": "INR",
                        "name": "Acme Corp", //your business name
                        "description": "Test Transaction",
                        "image": "https://example.com/your_logo",
                        "order_id": "order_9A33XWu170gUtm", //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
                        "callback_url": "https://eneqd3r9zrjok.x.pipedream.net/",
                        "prefill": { //We recommend using the prefill parameter to auto-fill customer's contact information especially their phone number
                        "name": {{user}}, //your customer's name
                        "email": {{user.email}},
                        "contact": "9000090000" //Provide the customer's phone number for better conversion rates 
                        },
                        "notes": {
                        "address": "Razorpay Corporate Office"
                        },
                        "theme": {
                        "color": "#3399cc"
                        }
                        };
                        var rzp1 = new Razorpay(options);
                        document.getElementById('rzp-button1').onclick = function(e){
                        rzp1.open();
                        e.preventDefault();
                        }
                        </script>
                    </form> {% endcomment %}
                    <form action="https://www.example.com/payment/success/" method="POST">
                        <script
                            src="https://checkout.razorpay.com/v1/checkout.js"
                            data-key="rzp_test_kaz60tEn560E6V" // Enter the Test API Key ID generated from Dashboard → Settings → API Keys
                            data-amount="29935" // Amount is in currency subunits. Hence, 29935 refers to 29935 paise or ₹299.35.
                            data-currency="INR"// You can accept international payments by changing the currency code. Contact our Support Team to enable International for your account
                            data-order_id="order_CgmcjRh9ti2lP7"// Replace with the order_id generated by you in the backend.
                            data-buttontext="Pay with Razorpay"
                            data-name="Acme Corp"
                            data-description="A Wild Sheep Chase is the third novel by Japanese author Haruki Murakami"
                            data-image="https://example.com/your_logo.jpg"
                            data-prefill.name={{user}}
                            data-prefill.email={{user.email}}
                            data-theme.color="#F37254"
                        ></script>
                        <input type="hidden" custom="Hidden Element" name="hidden"/>
                        </form>
                                                  
                    </div>
                    <form action="{% url 'remove-cart-item' item.id %}" method="post"> 
                        {% csrf_token %}  
                        <button type='submit' class='py-1'><span class='items-center justify-center'>Remove Item:<i class="fa-regular fa-trash-can w-6 h-6  font-serif 
                            items-baseline   text-blue-200 hover:text-blue-700"></i></span>
                        </button>
                    <br>    
                    </form>
                </li>
                </ul>  
            
            {% endif %}
        {% endfor %}
        <p class='py-2 font-bold text-left'>Total Price: {{total_price}}</p>
    {% else %}
        <p class='py-2 font-bold text-left'>Please log in to view your cart.</p>
    {% endif %}      
</div>
{% endblock cart_block %}