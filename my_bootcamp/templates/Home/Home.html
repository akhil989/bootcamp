{% extends "base.html" %}
{% block home %}
<div class='w-full'>
    
    {% for item in form  %}   
       
    {% if item %}
            
        {% endif %}
        <ul class='my-2 p-2'>
           
            <div class='bg-slate-800  grid md:grid-cols-2 gap-2 p-2 h-full'>
                <div class='p-2 col-span-1 rounded-lg bg-black'>
                <div>
                <h3 class='font-bold text-lg text-gray-300 text-ellipsis overflow-x-scroll no-scrollbar'>{{item.title|capfirst}}</h3>
                </div>
                
                {% if item.free_course or item.id in purchase_bag %}
                <video controls autoplay-off class='w-full'>
                    <source src="/media/{{item.video}}" type='video/mp4'>
                </video>
                {% else %}
                <img src="/media/{{ item.thumbnail }}" alt="name" class="w-full h-[550px]"></img>
                {% endif %}
                    
                <div class='grid grid-cols-5 text-right'>
                    <div class='col-span-1'></div>
                    <div class='col-span-1'>
                        
                        {% if user.is_authenticated %}
                            {% if user.id == item.instructor_id %}
                            <a href="{% url 'item-details' item.id %}"><button type="submit" class='text-center py-4'><i class="fa-regular fa-pen-to-square  text-blue-300 w-6 h-6 "></i><br>Edit Your Post</button></a>
                            {% endif %}
                        {% endif %}
                            
                    </div>
                    <div class='col-span-1 text-right'>
                        
                        {% if not item.free_course %}
                        <button type="button" class='text-center py-4'><i class="fa-regular fa-credit-card  text-blue-300 w-6 h-6 "></i><br>Buy</button>
                        {% endif %}
                            
                    </div>
                    <div class='col-span-1'>
                        {% if user.is_authenticated %}
                        {% if user.id in item.liked_users %}
                            <form action="{% url 'like_video' item.id %}" method="post">
                                {% csrf_token %}
                                <button type="submit" class='text-center py-4'><i class="fa-solid fa-heart  text-orange-600 w-6 h-6 "></i><br> you liked</button>
                            </form>
                        {% else %}
                            <form action="{% url 'like_video' item.id %}" method="post">
                                {% csrf_token %}
                                <button type="submit" class='text-center py-4'><i class="fa-regular fa-heart  text-orange-600 w-6 h-6 "></i><br>add like</button>
                            </form>
                        {% endif %}
                        {% else %}
                        <a href="{% url 'login' %}"><button type="submit" class='text-center py-4'><i class="fa-regular fa-heart  text-orange-600 w-6 h-6 "></i><br>add like</button></a>
                        {% endif %}
                    </div>
                    <div class='col-span-1'>
                        {% if user.is_authenticated %}
                            {% if user.id in item.cart_users %}
                                <form action="{% url 'cart-item' item.id %}" method="post"> 
                                    {% csrf_token %}  
                                <button type='submit' class='py-4'><i class="fa-solid fa-cart-shopping w-6 h-6 font-serif 
                                    items-center   text-orange-700"></i><br>Item carted</button>
                                <br>
                                </form>
                            {% elif item.id in purchase_bag %}
                                <button type='button' class='py-4'><i class="fa-solid fa-check-double w-6 h-6 font-serif 
                                    items-center   text-green-700"></i><br>Item Purchased
                                </button>
                            {% else %}
                                <form action="{% url 'cart-item' item.id %}" method="post"> 
                                    {% csrf_token %}  
                                <button type='submit' class='py-4'><i class="fa-solid fa-cart-shopping w-6 h-6 font-serif 
                                    items-center   text-slate-200 hover:text-slate-200"></i><br>Add Cart</button>
                                <br>
                                </form>
                            {% endif %}
                        {% else %}
                            <a href="{% url 'login' %}"><button type='submit' class='py-4'><i class="fa-solid fa-cart-shopping w-6 h-6 font-serif 
                                items-center   text-orange-700"></i></button></a> 
                        {% endif %}
                    </div>
                </div>
                </div>
                <div class='p-2 col-span-1 overflow-y-scroll  no-scrollbar py-2'>
                <form class='' action="{% url "home-page" %}" method='get'>
                    {% csrf_token %}
                    <h3><button class='' type='submit' value="{{item.instructor_id}}" name="search_instructor"><span class='text-lg font-mono font-bold'>Posted By :</span> <span class='text-purple-700 underline'>{{item.instructor.username}}</span></button></h3>
                </form>
                <p><span class='text-lg font-mono font-bold'>Published On :</span> {{item.created_at}}</p>
                <p><span class='text-lg font-mono font-bold'>Price:</span> {{item.price}}</p>
                <p class='text-pretty overflow-y-scroll sup-scrollbar1 h-72'><span class='text-lg font-mono font-bold'>Description:</span>  <span class='p-2'>{{item.description}}</span></p>
                <p><span class='text-lg font-mono font-bold'>Likes:</span> {{item.total_likes}}</p>
                <p><span class='text-lg font-mono font-bold'>Rating:</span> {{item.average_rating}}</p>
                <p>
                    <a href="{% url 'item-details' item.id %}"><button class='p-1 bg-blue-500 border border-blue-200 my-2' id='rate_video'>Rate This Video:</button></a>
                </p>
                <p>
                    <span class='font-bold underline text-violet-700 text-lg font-mono '>Comments:-</span>
                    <ul class='p-2 h-44 overflow-y-scroll sup-scrollbar bg-gray-800 my-2 border-gray-400 rounded-lg'>
                    {% for comment in item.comments.all  %}
                            <li>
                                <span class='font-bold mr-2'>{{comment.user}}:</span>{{comment.comment}}
                           
                           {% if comment.user.id == user.id %}
                           <a href="{% url 'comment-delete' comment.id %}"><button type="submit" class='text-right text-xs pl-10'><i class="fa-regular fa-trash-can  text-blue-300 w-4 h-4 "></i><br></button></a>
                           {% endif %}
                            </li>
                            
                    {% endfor %}
                    </ul>
                </p>
                <p class='text-right'>
                    <a href="{% url 'item-details' item.id %}"><button type='submit' class='bg-green-700 p-2 rounded-md'>Post Comment</button></a>
                </p>

            </div>
        </ul>  

    {% endfor %}
    
        
</div><br>
{% endblock home %}